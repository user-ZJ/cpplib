梅尔频谱
==============

概念介绍
-----------------

梅尔倒频谱(MFC)
`````````````````````````````````````````````````
梅尔倒频谱(Mel-Frequency Spectrum, MFC)是一个可用来代表短期音讯的频谱，
其原理根基于以非线性的梅尔刻度(mel scale)表示的对数频谱(spectrum)及其线性余弦转换(linear cosine transform)之上

梅尔倒频谱系数(MFCC)
`````````````````````
梅尔倒频谱系数 (Mel-Frequency Cipstal Coefficients, MFCC)是一组用来建立梅尔倒频谱的关键系数，是在Mel标度频率域提取出来的倒谱参数

梅尔刻度
```````````
梅尔刻度(又称Mel尺度/Mel标度，英语：Mel scale)，是一种基于人耳对等距的音高(pitch)变化的感官判断而定的非线性频率刻度。
将f赫兹转换为m梅尔刻度的公式是  

.. math:: 
    m = 2595*log_{10}{(1+ \frac{f}{700})} = 1127*log_{e}{(1+ \frac{f}{700})}

对应的逆向公式为：

.. math:: 
    f = 700(10^{m/2595}-1) = 700(e^{m/1127}-1)

梅尔与赫兹的对应图:

.. image:: /images/audio_mel01.png

梅尔滤波器是一组包含20-40个（标准26个）三角滤波器的滤波器。根据梅尔尺度（Mel scale）设置每一个滤波器

MFCC
---------------
mfcc特征的提取过程
`````````````````````````````
.. image:: /images/audio_mfcc01.png

预加重
```````````````
对信号应用预加重滤波器(高通滤波器)以放大高频，预加重滤波器在以下几个方面很有用：

* 平衡频谱，因为高频通常与较低频率相比具有较小的幅度，
* 避免在傅里叶变换操作操作过程中出现数值问题
* 改善信号 - 噪声比（SNR）
* 消除发声过程中声带和嘴唇的效应，来补偿语音信号受到发音系统所抑制的高频部分，也为了突出高频的共振峰。

预加重处理其实是将语音信号通过一个高通滤波器：

.. math:: 
    y(t) = x(t) - \alpha x(t-1)

其中滤波器系数 :math:`\alpha` 的通常为0.95或0.97。

分帧
`````````````````
在预加重之后，我们需要将信号分成短时帧。
语音信号是短时平稳信号，这表示对于整个信号来说，它是非平稳的。
如果对对整个信号进行傅里叶变换，我们会随着时间的推移丢失信号的频率轮廓，
因此选择在短时帧上进行傅里叶变换，通过连接相邻帧来获得信号频率轮廓的良好近似。
将信号帧化为20-40 ms帧，标准是25ms。过短不能保证有足够的采样点获取可靠的能谱估计，过长时信号改变太多。
这意味着8kHz信号的帧长度为0.025 * 8000 = 200个采样点。帧移通常为10毫秒 ，即0.01*8000 = 80个采样点。
同时为了避免相邻两帧的变化过大，两相邻帧之间会设有一段重叠区域，通常约为每帧语音的1/2或1/3或50%(+/-10%)。

加窗
`````````````````
将信号分割成帧后，我们再对每个帧乘以一个窗函数，如Hamming窗口、矩形窗等，以增加帧左端和右端的连续性。
抵消FFT假设（数据是无限的），并减少频谱泄漏。

`频谱泄漏 <https://baike.baidu.com/item/%E9%A2%91%E8%B0%B1%E6%B3%84%E6%BC%8F/4059521>`_ :简单说来 ,
造成频谱泄漏的原因是采样频率与信号频率不同步 ,造成周期采样信号的相位在始端和终端不连续

各种窗函数介绍: https://zh.wikipedia.org/wiki/%E7%AA%97%E5%87%BD%E6%95%B0 

Hann窗:

.. math:: 
    w(n) = 0.5(1-cos(\frac{2 \pi n}{N-1}))

Hamming窗:

.. math:: 
    w(n) = 0.54 - 0.46cos(\frac{2 \pi n}{N-1})

FFT（傅立叶变换）
```````````````````````
由于信号在时域上的变换通常很难看出信号的特性，通常对它做FFT变换转换为频域上的能量分布来观察，不同的能量分布，就能代表不同语音的特性。
对分帧加窗后的各帧信号进行做一个N点FFT来计算频谱，也称为短时傅立叶变换（STFT），其中N通常为256或512。

.. math:: 
    S_{i}{k} = \sum_{n-1}^{N}s_{i}{(n)} e^{-j2 \pi kn/N}; 1 \le k \le K

计算功率谱（取平方）
```````````````````````````
使用以下公式计算功率谱（周期图periodogram），对语音信号的频谱取模平方（取对数或者取平方，
因为频率不可能为负，负值要舍去）得到语音信号的谱线能量。其中 :math:`x_i` 是信号X的第i帧。

.. math:: 
    P = \frac{|FFT(x_i)|^2}{N}

滤波器组（Mel滤波）
`````````````````````````
将功率谱通过一组Mel刻度（通常取22-40，标准值为26）的三角滤波器来提取频带(frequency bands)。
这个Mel滤波器组就像人类的听觉感知系统（耳朵），人耳只关注某些特定的频率分量（人的听觉对频率是有选择性的）。
它对不同频率信号的灵敏度是不同的，换言之，它只让某些频率的信号通过，而压根就直接无视它不想感知的某些频率信号。
但是这些滤波器在频率坐标轴上却不是统一分布的，在低频区域有很多的滤波器，他们分布比较密集，
但在高频区域，滤波器的数目就变得比较少，分布很稀疏。
因此Mel刻度的目的是模拟人耳对声音的非线性感知，在较低的频率下更具辨别力，在较高的频率下则不具辨别力。

.. image:: /images/audio_mfcc02.png

以采样率8K，fft窗口大小为512，梅尔滤波器个数为40为例:

其中 :math:`f_m` 为[0,4000]对通过f赫兹转换为m梅尔刻度的公式转化为mel刻度后，进行41等分，再转换为f赫兹后的42x1的一维矩阵；  
k为[0,4000]进行256等分形成的257x1的一维矩阵，又称FFT bin/fftfreqs。  

:math:`B_{m}{[k]}` 是40x257矩阵，表示40个梅尔滤波器

将傅里叶变换后的虚数矩阵取模的平方后和梅尔滤波器相乘，得到的结果即为梅尔刻度，对梅尔刻度取对数，即为 **梅尔频谱**    

.. image:: /images/audio_mfcc03.png

.. image:: /images/audio_mfcc04.png

离散余弦变换（DTC）
`````````````````````````
应用离散余弦变换对滤波器组系数去相关处理，并产生滤波器组的压缩表示。
通常，对于自动语音识别（ASR），保留所得到的2-13阶倒频谱系数，其余部分被丢弃，
丢弃其他系数的原因是它们代表了滤波器组系数的快速变化，并且这些精细的细节对自动语音识别（ASR）没有贡献。
公式中L阶指MFCC系数阶数，通常取2-13。前面几个系数表示的是倒谱的低频部分。
一般用于做声纹识别的时候看重的是频谱的包络信息，就是低频部分。这里M是三角滤波器个数。

.. math:: 
    C(n) = \sum_{m=0}^{N-1}s(m)cos(\frac{\pi n(m-0.5)}{M}),n=1,2,...,L

mfcc特征与fbank的区别
-------------------------------
fbank只是缺少mfcc特征提取的dct倒谱环节，其他步骤相同。

**fbank的不足**：fBank特征已经很贴近人耳的响应特性，但是仍有一些不足，其相邻的特征高度相关（相邻滤波器组有重叠），
因此当我们用HMM对音素建模的时候，几乎总需要首先进行倒谱转换，通过这样得到MFCC特征。

**计算量**：MFCC是在FBank的基础上进行的，所以MFCC的计算量更大。

**特征区分度**：FBank特征相关性较高，MFCC具有更好的判别度，所以大多数语音识别论文中用的是MFCC，而不是FBank。